---
import { config } from '../config';

const gallery = config.gallery;
---

<section class="section bg-secondary" id="gallery">
  <div class="container">
    <div class="text-center animate-on-scroll">
      <h2 class="section-title">Our Gallery</h2>
      <p class="section-subtitle">Moments we've shared together</p>
    </div>

    <div class="gallery-grid stagger-children" id="gallery-grid">
      {gallery.map((photo, index) => (
        <div
          class="gallery-item"
          data-index={index}
          data-src={photo.src}
          data-alt={photo.alt}
        >
          <img
            src={photo.src}
            alt={photo.alt}
            loading="lazy"
            onerror="this.parentElement.classList.add('bg-gray-200'); this.style.display='none';"
          />
        </div>
      ))}
    </div>

    {gallery.length === 0 && (
      <div class="text-center py-12 text-muted">
        <p>Photos coming soon...</p>
      </div>
    )}
  </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <button class="lightbox-close" id="lightbox-close" aria-label="Close lightbox">&times;</button>
  <button class="lightbox-nav lightbox-prev" id="lightbox-prev" aria-label="Previous image">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </button>
  <button class="lightbox-nav lightbox-next" id="lightbox-next" aria-label="Next image">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
  </button>
  <img src="" alt="" id="lightbox-img" />
</div>

<style>
  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    transition: opacity 0.3s;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
  }

  .lightbox-nav:hover {
    background: rgba(0, 0, 0, 0.5);
  }

  .lightbox-prev {
    left: 1rem;
  }

  .lightbox-next {
    right: 1rem;
  }

  @media (min-width: 768px) {
    .lightbox-prev {
      left: 2rem;
    }
    .lightbox-next {
      right: 2rem;
    }
  }
</style>

<script>
  const galleryGrid = document.getElementById('gallery-grid');
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const lightboxClose = document.getElementById('lightbox-close');
  const lightboxPrev = document.getElementById('lightbox-prev');
  const lightboxNext = document.getElementById('lightbox-next');

  let currentIndex = 0;
  let galleryItems: NodeListOf<Element>;

  if (galleryGrid && lightbox && lightboxImg) {
    galleryItems = galleryGrid.querySelectorAll('.gallery-item');

    // Open lightbox on click
    galleryItems.forEach((item, index) => {
      item.addEventListener('click', () => {
        currentIndex = index;
        openLightbox();
      });
    });

    // Close lightbox
    lightboxClose?.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Navigation
    lightboxPrev?.addEventListener('click', (e) => {
      e.stopPropagation();
      navigate(-1);
    });

    lightboxNext?.addEventListener('click', (e) => {
      e.stopPropagation();
      navigate(1);
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('is-open')) return;

      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft') navigate(-1);
      if (e.key === 'ArrowRight') navigate(1);
    });
  }

  function openLightbox() {
    if (!lightbox || !lightboxImg || !galleryItems) return;

    const item = galleryItems[currentIndex] as HTMLElement;
    const src = item.dataset.src || '';
    const alt = item.dataset.alt || '';

    lightboxImg.src = src;
    lightboxImg.alt = alt;
    lightbox.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    if (!lightbox) return;

    lightbox.classList.remove('is-open');
    document.body.style.overflow = '';
  }

  function navigate(direction: number) {
    if (!galleryItems) return;

    currentIndex = (currentIndex + direction + galleryItems.length) % galleryItems.length;
    openLightbox();
  }
</script>
