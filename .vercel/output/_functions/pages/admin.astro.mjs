import { e as createComponent, r as renderTemplate, n as defineScriptVars, k as renderHead, h as createAstro } from '../chunks/astro/server_BruaL4hw.mjs';
import 'piccolore';
import 'clsx';
import { c as config } from '../chunks/config_B7u3G6-8.mjs';
/* empty css                                 */
export { renderers } from '../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const prerender = false;
const $$Index = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Index;
  const authCookie = Astro2.cookies.get("admin_auth");
  if (authCookie?.value !== "authenticated") {
    return Astro2.redirect("/admin/login");
  }
  const pageTitle = `Admin Dashboard - ${config.site.title}`;
  const siteUrl = "https://aldi-cynthia.com";
  return renderTemplate(_a || (_a = __template(['<html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="robots" content="noindex, nofollow"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet"><title>', "</title>", `</head> <body> <div class="admin-layout"> <!-- Sidebar --> <aside class="sidebar"> <div class="sidebar-title">Wedding Admin</div> <nav class="sidebar-nav"> <a href="#dashboard" class="sidebar-link active" data-tab="dashboard"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
Dashboard
</a> <a href="#guests" class="sidebar-link" data-tab="guests"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
Guests
</a> <a href="#invitations" class="sidebar-link" data-tab="invitations"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
Send Invites
</a> <a href="#messages" class="sidebar-link" data-tab="messages"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
Messages
</a> <a href="#import" class="sidebar-link" data-tab="import"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
Import CSV
</a> </nav> <div style="margin-top: auto; padding-top: 2rem;"> <a href="/" class="sidebar-link" target="_blank"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
View Website
</a> <button class="sidebar-link" id="logout-btn" style="width: 100%; border: none; background: none; cursor: pointer;"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
Logout
</button> </div> </aside> <!-- Main Content --> <main class="main-content"> <!-- Dashboard Tab --> <div id="dashboard-tab" class="tabs active"> <div class="page-header"> <h1 class="page-title">Dashboard</h1> </div> <div class="stats-grid" id="stats-container"> <div class="stat-card"> <div class="stat-label">Total Invited</div> <div class="stat-value" id="stat-total">-</div> </div> <div class="stat-card"> <div class="stat-label">Confirmed</div> <div class="stat-value" id="stat-confirmed">-</div> </div> <div class="stat-card"> <div class="stat-label">Pending</div> <div class="stat-value pending" id="stat-pending">-</div> </div> <div class="stat-card"> <div class="stat-label">Declined</div> <div class="stat-value declined" id="stat-declined">-</div> </div> <div class="stat-card"> <div class="stat-label">Total Attending</div> <div class="stat-value" id="stat-attending">-</div> </div> </div> <div class="card"> <div class="card-header"> <h2 class="card-title">Recent RSVPs</h2> </div> <div class="card-body"> <div class="table-container"> <table id="recent-rsvps"> <thead> <tr> <th>Name</th> <th>Status</th> <th>Plus Ones</th> <th>Updated</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Guests Tab --> <div id="guests-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Guest List</h1> <button class="btn btn-primary" id="add-guest-btn"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1rem; height: 1rem;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
Add Guest
</button> </div> <!-- Filters --> <div class="card" style="margin-bottom: 1rem;"> <div class="card-body" style="padding: 1rem;"> <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;"> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by Side</label> <select class="form-select" id="filter-side" style="min-width: 150px;"> <option value="all">All Guests</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> <option value="both">Both Sides</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by RSVP</label> <select class="form-select" id="filter-rsvp" style="min-width: 150px;"> <option value="all">All Status</option> <option value="pending">Pending</option> <option value="yes">Confirmed</option> <option value="no">Declined</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Search</label> <input type="text" class="form-input" id="filter-search" placeholder="Search by name..." style="min-width: 200px;"> </div> <div style="margin-left: auto; align-self: flex-end;"> <span id="filter-count" style="color: #718096; font-size: 0.875rem;"></span> </div> </div> </div> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="guests-table"> <thead> <tr> <th>Name</th> <th>Side</th> <th>Phone</th> <th>+1s</th> <th>Attending</th> <th>RSVP</th> <th>Unique Link</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Invitations Tab --> <div id="invitations-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Send WhatsApp Invitations</h1> </div> <!-- Message Template Card --> <div class="card" style="margin-bottom: 1.5rem;"> <div class="card-header"> <h2 class="card-title">Message Template</h2> </div> <div class="card-body"> <p style="margin-bottom: 1rem; color: #718096; font-size: 0.875rem;">
Configure the invitation message template. Use <code>`, "</code> for guest name and <code>", '</code> for their unique RSVP link.\n</p> <div class="form-group"> <label class="form-label">WhatsApp Message Template</label> <textarea class="form-textarea" id="wa-template" rows="5" style="font-family: monospace;">', `</textarea> </div> <button class="btn btn-primary" id="save-template-btn">Save Template</button> </div> </div> <!-- Filter and Guest List --> <div class="card" style="margin-bottom: 1rem;"> <div class="card-body" style="padding: 1rem;"> <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;"> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by Side</label> <select class="form-select" id="invite-filter-side" style="min-width: 150px;"> <option value="all">All Guests</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Has Phone Number</label> <select class="form-select" id="invite-filter-phone" style="min-width: 150px;"> <option value="yes">With Phone Only</option> <option value="all">All Guests</option> </select> </div> <div style="margin-left: auto; align-self: flex-end;"> <span id="invite-count" style="color: #718096; font-size: 0.875rem;"></span> </div> </div> </div> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="invitations-table"> <thead> <tr> <th>Name</th> <th>Side</th> <th>Phone</th> <th>RSVP Status</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Messages Tab --> <div id="messages-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Messages</h1> <button class="btn btn-primary" id="add-message-btn"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1rem; height: 1rem;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
Add Message
</button> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="messages-table"> <thead> <tr> <th>Guest Name</th> <th>Message</th> <th>Visible</th> <th>Date</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Import Tab --> <div id="import-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Import Guests from CSV</h1> </div> <div class="card"> <div class="card-body"> <p style="margin-bottom: 1rem; color: #718096;">
Upload a CSV file with guest information. The file should have the following columns:
<code style="background: #f7fafc; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">name, email, phone, guest_side, invited_to, max_plus_ones</code> </p> <p style="margin-bottom: 1.5rem; color: #718096; font-size: 0.875rem;">
Note: <code>guest_side</code> can be "groom", "bride", or "both" (default). <code>invited_to</code> can be "ceremony", "reception", or "both" (default). <code>max_plus_ones</code> is the number of additional guests they can bring (default: 0).
</p> <label class="file-upload" id="csv-upload"> <input type="file" accept=".csv" id="csv-file"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 3rem; height: 3rem; margin-bottom: 1rem; color: #718096;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> <p style="color: #4a5568; font-weight: 500;">Click to upload or drag and drop</p> <p style="color: #718096; font-size: 0.875rem;">CSV file only</p> </label> <div id="csv-preview" style="margin-top: 1.5rem; display: none;"> <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Preview</h3> <div class="table-container"> <table id="csv-preview-table"> <thead></thead> <tbody></tbody> </table> </div> <div style="margin-top: 1rem; display: flex; gap: 0.75rem;"> <button class="btn btn-primary" id="import-btn">Import Guests</button> <button class="btn btn-secondary" id="cancel-import-btn">Cancel</button> </div> </div> <div id="import-result" style="margin-top: 1.5rem; display: none;"></div> </div> </div> <div class="card"> <div class="card-header"> <h2 class="card-title">Sample CSV Format</h2> </div> <div class="card-body"> <pre style="background: #f7fafc; padding: 1rem; border-radius: 0.375rem; overflow-x: auto; font-size: 0.875rem;">name,email,phone,guest_side,invited_to,max_plus_ones
John Doe,john@example.com,+1234567890,groom,both,1
Jane Smith,jane@example.com,,bride,ceremony,0
Bob Johnson,,+0987654321,both,reception,2</pre> </div> </div> </div> </main> </div> <!-- Add Guest Modal --> <div class="modal-overlay" id="add-guest-modal"> <div class="modal"> <div class="modal-header"> <h3 class="modal-title">Add New Guest</h3> <button class="modal-close" data-close-modal>&times;</button> </div> <form id="add-guest-form"> <div class="modal-body"> <div class="form-group"> <label class="form-label">Name *</label> <input type="text" class="form-input" name="name" required> </div> <div class="form-group"> <label class="form-label">Email</label> <input type="email" class="form-input" name="email"> </div> <div class="form-group"> <label class="form-label">Phone (for WhatsApp)</label> <input type="tel" class="form-input" name="phone" placeholder="+628123456789"> </div> <div class="form-group"> <label class="form-label">Guest Side</label> <select class="form-select" name="guest_side"> <option value="both">Both (Mutual Friend)</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> </select> </div> <div class="form-group"> <label class="form-label">Invited To</label> <select class="form-select" name="invited_to"> <option value="both">Both Events</option> <option value="ceremony">Ceremony Only</option> <option value="reception">Reception Only</option> </select> </div> <div class="form-group"> <label class="form-label">Allocated Plus Ones</label> <input type="number" class="form-input" name="max_plus_ones" min="0" max="10" value="0"> <p style="font-size: 0.75rem; color: #718096; margin-top: 0.25rem;">Number of additional guests this person can bring</p> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary">Add Guest</button> </div> </form> </div> </div> <!-- Add Message Modal --> <div class="modal-overlay" id="add-message-modal"> <div class="modal"> <div class="modal-header"> <h3 class="modal-title">Add New Message</h3> <button class="modal-close" data-close-modal>&times;</button> </div> <form id="add-message-form"> <div class="modal-body"> <div class="form-group"> <label class="form-label">Guest Name *</label> <input type="text" class="form-input" name="guest_name" required> </div> <div class="form-group"> <label class="form-label">Message *</label> <textarea class="form-textarea" name="content" required></textarea> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary">Add Message</button> </div> </form> </div> </div> <!-- Toast --> <div class="toast" id="toast"></div> <script>(function(){`, "\n      // State\n      let guests = [];\n      let messages = [];\n      let csvData = [];\n\n      // DOM Elements\n      const tabs = document.querySelectorAll('.tabs');\n      const sidebarLinks = document.querySelectorAll('.sidebar-link[data-tab]');\n      const toast = document.getElementById('toast');\n\n      // Initialize\n      document.addEventListener('DOMContentLoaded', () => {\n        loadStats();\n        loadGuests();\n        loadMessages();\n        setupEventListeners();\n        loadWhatsAppTemplate();\n      });\n\n      // Tab Navigation\n      function switchTab(tabName) {\n        tabs.forEach(tab => tab.classList.remove('active'));\n        sidebarLinks.forEach(link => link.classList.remove('active'));\n\n        document.getElementById(`${tabName}-tab`)?.classList.add('active');\n        document.querySelector(`[data-tab=\"${tabName}\"]`)?.classList.add('active');\n      }\n\n      sidebarLinks.forEach(link => {\n        link.addEventListener('click', (e) => {\n          e.preventDefault();\n          const tab = link.dataset.tab;\n          switchTab(tab);\n          history.pushState(null, '', `#${tab}`);\n        });\n      });\n\n      // Handle initial hash\n      const initialTab = window.location.hash.slice(1) || 'dashboard';\n      switchTab(initialTab);\n\n      // Toast Notification\n      function showToast(message, type = 'success') {\n        toast.textContent = message;\n        toast.className = `toast ${type} show`;\n        setTimeout(() => {\n          toast.classList.remove('show');\n        }, 3000);\n      }\n\n      // Load Stats\n      async function loadStats() {\n        try {\n          const response = await fetch('/api/admin/guests?action=stats');\n          if (!response.ok) throw new Error('Failed to load stats');\n          const stats = await response.json();\n\n          document.getElementById('stat-total').textContent = stats.total;\n          document.getElementById('stat-confirmed').textContent = stats.confirmed;\n          document.getElementById('stat-pending').textContent = stats.pending;\n          document.getElementById('stat-declined').textContent = stats.declined;\n          document.getElementById('stat-attending').textContent = stats.totalGuests;\n        } catch (error) {\n          console.error('Error loading stats:', error);\n        }\n      }\n\n      // Load Guests\n      async function loadGuests() {\n        try {\n          const response = await fetch('/api/admin/guests');\n          if (!response.ok) throw new Error('Failed to load guests');\n          const data = await response.json();\n          guests = data.guests || [];\n          renderGuests();\n          renderRecentRSVPs();\n          renderInvitations();\n        } catch (error) {\n          console.error('Error loading guests:', error);\n        }\n      }\n\n      // Get filtered guests\n      function getFilteredGuests() {\n        const sideFilter = document.getElementById('filter-side')?.value || 'all';\n        const rsvpFilter = document.getElementById('filter-rsvp')?.value || 'all';\n        const searchFilter = document.getElementById('filter-search')?.value?.toLowerCase() || '';\n\n        return guests.filter(guest => {\n          const matchesSide = sideFilter === 'all' || guest.guest_side === sideFilter;\n          const matchesRsvp = rsvpFilter === 'all' || guest.rsvp_status === rsvpFilter;\n          const matchesSearch = !searchFilter || guest.name.toLowerCase().includes(searchFilter);\n          return matchesSide && matchesRsvp && matchesSearch;\n        });\n      }\n\n      // Get side badge HTML\n      function getSideBadge(side) {\n        const colors = {\n          groom: 'background: #BEE3F8; color: #2B6CB0;',\n          bride: 'background: #FED7E2; color: #97266D;',\n          both: 'background: #E9D8FD; color: #6B46C1;'\n        };\n        const labels = {\n          groom: \"Groom's\",\n          bride: \"Bride's\",\n          both: 'Both'\n        };\n        return `<span class=\"badge\" style=\"${colors[side] || colors.both}\">${labels[side] || 'Both'}</span>`;\n      }\n\n      // Render Guests Table\n      function renderGuests() {\n        const tbody = document.querySelector('#guests-table tbody');\n        const filteredGuests = getFilteredGuests();\n        \n        // Update count\n        const countEl = document.getElementById('filter-count');\n        if (countEl) {\n          countEl.textContent = `Showing ${filteredGuests.length} of ${guests.length} guests`;\n        }\n\n        if (filteredGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"8\" style=\"text-align: center; color: #718096;\">No guests found</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = filteredGuests.map(guest => `\n          <tr>\n            <td>${escapeHtml(guest.name)}</td>\n            <td>${getSideBadge(guest.guest_side)}</td>\n            <td>${escapeHtml(guest.phone || '-')}</td>\n            <td>${guest.max_plus_ones || 0}</td>\n            <td>${guest.attending_count || 0}</td>\n            <td>\n              <span class=\"badge badge-${guest.rsvp_status === 'yes' ? 'success' : guest.rsvp_status === 'no' ? 'danger' : 'warning'}\">\n                ${guest.rsvp_status === 'yes' ? 'Confirmed' : guest.rsvp_status === 'no' ? 'Declined' : 'Pending'}\n              </span>\n            </td>\n            <td>\n              <div class=\"copy-link\">\n                <input type=\"text\" value=\"${siteUrl}/rsvp/${guest.unique_code}\" readonly />\n                <button class=\"btn btn-sm btn-secondary\" onclick=\"copyLink('${guest.unique_code}')\">Copy</button>\n              </div>\n            </td>\n            <td>\n              <span class=\"action-link danger\" onclick=\"deleteGuest('${guest.id}')\">Delete</span>\n            </td>\n          </tr>\n        `).join('');\n      }\n\n      // Render Recent RSVPs\n      function renderRecentRSVPs() {\n        const tbody = document.querySelector('#recent-rsvps tbody');\n        const recentGuests = guests\n          .filter(g => g.rsvp_status !== 'pending')\n          .sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())\n          .slice(0, 10);\n\n        if (recentGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"4\" style=\"text-align: center; color: #718096;\">No RSVPs yet</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = recentGuests.map(guest => `\n          <tr>\n            <td>${escapeHtml(guest.name)}</td>\n            <td>\n              <span class=\"badge badge-${guest.rsvp_status === 'yes' ? 'success' : 'danger'}\">\n                ${guest.rsvp_status === 'yes' ? 'Confirmed' : 'Declined'}\n              </span>\n            </td>\n            <td>${guest.attending_count || 0}</td>\n            <td>${new Date(guest.updated_at).toLocaleDateString()}</td>\n          </tr>\n        `).join('');\n      }\n\n      // Load Messages\n      async function loadMessages() {\n        try {\n          const response = await fetch('/api/admin/messages');\n          if (!response.ok) throw new Error('Failed to load messages');\n          const data = await response.json();\n          messages = data.messages || [];\n          renderMessages();\n        } catch (error) {\n          console.error('Error loading messages:', error);\n        }\n      }\n\n      // Render Messages Table\n      function renderMessages() {\n        const tbody = document.querySelector('#messages-table tbody');\n        if (messages.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">No messages yet</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = messages.map(msg => `\n          <tr>\n            <td>${escapeHtml(msg.guest_name)}</td>\n            <td style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">\n              ${escapeHtml(msg.content)}\n            </td>\n            <td>\n              <label style=\"cursor: pointer;\">\n                <input type=\"checkbox\" ${msg.is_visible ? 'checked' : ''} onchange=\"toggleVisibility('${msg.id}', this.checked)\" />\n              </label>\n            </td>\n            <td>${new Date(msg.created_at).toLocaleDateString()}</td>\n            <td>\n              <span class=\"action-link danger\" onclick=\"deleteMessage('${msg.id}')\">Delete</span>\n            </td>\n          </tr>\n        `).join('');\n      }\n\n      // Event Listeners\n      function setupEventListeners() {\n        // Logout\n        document.getElementById('logout-btn').addEventListener('click', async () => {\n          await fetch('/api/admin/logout', { method: 'POST' });\n          window.location.href = '/admin/login';\n        });\n\n        // Add Guest Modal\n        document.getElementById('add-guest-btn').addEventListener('click', () => {\n          document.getElementById('add-guest-modal').classList.add('is-open');\n        });\n\n        // Add Message Modal\n        document.getElementById('add-message-btn').addEventListener('click', () => {\n          document.getElementById('add-message-modal').classList.add('is-open');\n        });\n\n        // Close Modal\n        document.querySelectorAll('[data-close-modal]').forEach(btn => {\n          btn.addEventListener('click', () => {\n            document.querySelectorAll('.modal-overlay').forEach(modal => {\n              modal.classList.remove('is-open');\n            });\n          });\n        });\n\n        // Close modal on overlay click\n        document.querySelectorAll('.modal-overlay').forEach(overlay => {\n          overlay.addEventListener('click', (e) => {\n            if (e.target === overlay) {\n              overlay.classList.remove('is-open');\n            }\n          });\n        });\n\n        // Add Guest Form\n        document.getElementById('add-guest-form').addEventListener('submit', async (e) => {\n          e.preventDefault();\n          const form = e.target;\n          const formData = new FormData(form);\n\n          try {\n            const response = await fetch('/api/admin/guests', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                action: 'add',\n                guest: {\n                  name: formData.get('name'),\n                  email: formData.get('email'),\n                  phone: formData.get('phone'),\n                  guest_side: formData.get('guest_side') || 'both',\n                  invited_to: formData.get('invited_to'),\n                  max_plus_ones: parseInt(formData.get('max_plus_ones')) || 0,\n                }\n              })\n            });\n\n            if (!response.ok) throw new Error('Failed to add guest');\n\n            showToast('Guest added successfully');\n            form.reset();\n            document.getElementById('add-guest-modal').classList.remove('is-open');\n            loadGuests();\n            loadStats();\n          } catch (error) {\n            showToast('Failed to add guest', 'error');\n          }\n        });\n\n        // Add Message Form\n        document.getElementById('add-message-form').addEventListener('submit', async (e) => {\n          e.preventDefault();\n          const form = e.target;\n          const formData = new FormData(form);\n\n          try {\n            const response = await fetch('/api/admin/messages', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                guest_name: formData.get('guest_name'),\n                content: formData.get('content'),\n              })\n            });\n\n            if (!response.ok) throw new Error('Failed to add message');\n\n            showToast('Message added successfully');\n            form.reset();\n            document.getElementById('add-message-modal').classList.remove('is-open');\n            loadMessages();\n          } catch (error) {\n            showToast('Failed to add message', 'error');\n          }\n        });\n\n        // CSV Upload\n        const csvFile = document.getElementById('csv-file');\n        csvFile.addEventListener('change', handleCSVUpload);\n        document.getElementById('import-btn').addEventListener('click', importCSV);\n        document.getElementById('cancel-import-btn').addEventListener('click', () => {\n          csvData = [];\n          document.getElementById('csv-preview').style.display = 'none';\n          document.getElementById('csv-file').value = '';\n        });\n\n        // Filter event listeners\n        document.getElementById('filter-side')?.addEventListener('change', renderGuests);\n        document.getElementById('filter-rsvp')?.addEventListener('change', renderGuests);\n        document.getElementById('filter-search')?.addEventListener('input', renderGuests);\n\n        // Invitation filter event listeners\n        document.getElementById('invite-filter-side')?.addEventListener('change', renderInvitations);\n        document.getElementById('invite-filter-phone')?.addEventListener('change', renderInvitations);\n\n        // Save WhatsApp template\n        document.getElementById('save-template-btn')?.addEventListener('click', () => {\n          const template = document.getElementById('wa-template')?.value || '';\n          localStorage.setItem('wa_template', template);\n          showToast('Template saved!');\n        });\n      }\n\n      // Copy Link\n      window.copyLink = async function(code) {\n        const link = `${siteUrl}/rsvp/${code}`;\n        try {\n          await navigator.clipboard.writeText(link);\n          showToast('Link copied to clipboard');\n        } catch (error) {\n          showToast('Failed to copy link', 'error');\n        }\n      };\n\n      // Delete Guest\n      window.deleteGuest = async function(id) {\n        if (!confirm('Are you sure you want to delete this guest?')) return;\n\n        try {\n          const response = await fetch('/api/admin/guests', {\n            method: 'DELETE',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id })\n          });\n\n          if (!response.ok) throw new Error('Failed to delete guest');\n\n          showToast('Guest deleted');\n          loadGuests();\n          loadStats();\n        } catch (error) {\n          showToast('Failed to delete guest', 'error');\n        }\n      };\n\n      // Toggle Message Visibility\n      window.toggleVisibility = async function(id, isVisible) {\n        try {\n          const response = await fetch('/api/admin/messages', {\n            method: 'PATCH',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id, is_visible: isVisible })\n          });\n\n          if (!response.ok) throw new Error('Failed to update message');\n          showToast('Message visibility updated');\n        } catch (error) {\n          showToast('Failed to update message', 'error');\n          loadMessages();\n        }\n      };\n\n      // Delete Message\n      window.deleteMessage = async function(id) {\n        if (!confirm('Are you sure you want to delete this message?')) return;\n\n        try {\n          const response = await fetch('/api/admin/messages', {\n            method: 'DELETE',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id })\n          });\n\n          if (!response.ok) throw new Error('Failed to delete message');\n\n          showToast('Message deleted');\n          loadMessages();\n        } catch (error) {\n          showToast('Failed to delete message', 'error');\n        }\n      };\n\n      // CSV Upload Handler\n      function handleCSVUpload(e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = function(event) {\n          const text = event.target.result;\n          csvData = parseCSV(text);\n\n          if (csvData.length === 0) {\n            showToast('No valid data found in CSV', 'error');\n            return;\n          }\n\n          renderCSVPreview();\n          document.getElementById('csv-preview').style.display = 'block';\n        };\n        reader.readAsText(file);\n      }\n\n      // Parse CSV\n      function parseCSV(text) {\n        const lines = text.split('\\n').filter(line => line.trim());\n        if (lines.length < 2) return [];\n\n        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());\n        const nameIndex = headers.indexOf('name');\n        const emailIndex = headers.indexOf('email');\n        const phoneIndex = headers.indexOf('phone');\n        const guestSideIndex = headers.indexOf('guest_side');\n        const invitedToIndex = headers.indexOf('invited_to');\n        const maxPlusOnesIndex = headers.indexOf('max_plus_ones');\n\n        if (nameIndex === -1) {\n          showToast('CSV must have a \"name\" column', 'error');\n          return [];\n        }\n\n        return lines.slice(1).map(line => {\n          const values = line.split(',').map(v => v.trim());\n          return {\n            name: values[nameIndex] || '',\n            email: emailIndex !== -1 ? values[emailIndex] : '',\n            phone: phoneIndex !== -1 ? values[phoneIndex] : '',\n            guest_side: guestSideIndex !== -1 ? values[guestSideIndex] : 'both',\n            invited_to: invitedToIndex !== -1 ? values[invitedToIndex] : 'both',\n            max_plus_ones: maxPlusOnesIndex !== -1 ? parseInt(values[maxPlusOnesIndex]) || 0 : 0,\n          };\n        }).filter(guest => guest.name);\n      }\n\n      // Render CSV Preview\n      function renderCSVPreview() {\n        const thead = document.querySelector('#csv-preview-table thead');\n        const tbody = document.querySelector('#csv-preview-table tbody');\n\n        thead.innerHTML = '<tr><th>Name</th><th>Phone</th><th>Side</th><th>Invited To</th><th>+1s</th></tr>';\n        tbody.innerHTML = csvData.slice(0, 10).map(guest => `\n          <tr>\n            <td>${escapeHtml(guest.name)}</td>\n            <td>${escapeHtml(guest.phone || '-')}</td>\n            <td>${escapeHtml(guest.guest_side || 'both')}</td>\n            <td>${escapeHtml(guest.invited_to)}</td>\n            <td>${guest.max_plus_ones || 0}</td>\n          </tr>\n        `).join('');\n\n        if (csvData.length > 10) {\n          tbody.innerHTML += `<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">... and ${csvData.length - 10} more</td></tr>`;\n        }\n      }\n\n      // Import CSV\n      async function importCSV() {\n        if (csvData.length === 0) return;\n\n        const importBtn = document.getElementById('import-btn');\n        importBtn.disabled = true;\n        importBtn.textContent = 'Importing...';\n\n        try {\n          const response = await fetch('/api/admin/guests', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              action: 'import',\n              guests: csvData\n            })\n          });\n\n          if (!response.ok) throw new Error('Failed to import guests');\n\n          const result = await response.json();\n\n          document.getElementById('import-result').style.display = 'block';\n          document.getElementById('import-result').innerHTML = `\n            <div style=\"padding: 1rem; background: #C6F6D5; border-radius: 0.375rem;\">\n              <p><strong>Import Complete!</strong></p>\n              <p>Successfully imported: ${result.success}</p>\n              ${result.failed > 0 ? `<p style=\"color: #E53E3E;\">Failed: ${result.failed}</p>` : ''}\n            </div>\n          `;\n\n          csvData = [];\n          document.getElementById('csv-preview').style.display = 'none';\n          document.getElementById('csv-file').value = '';\n          loadGuests();\n          loadStats();\n        } catch (error) {\n          showToast('Failed to import guests', 'error');\n        } finally {\n          importBtn.disabled = false;\n          importBtn.textContent = 'Import Guests';\n        }\n      }\n\n      // Escape HTML\n      function escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n      }\n\n      // Load WhatsApp Template from localStorage\n      function loadWhatsAppTemplate() {\n        const saved = localStorage.getItem('wa_template');\n        const templateEl = document.getElementById('wa-template');\n        if (saved && templateEl) {\n          templateEl.value = saved;\n        }\n      }\n\n      // Get WhatsApp message for a guest\n      function getWhatsAppMessage(guest) {\n        const templateEl = document.getElementById('wa-template');\n        const template = templateEl?.value || localStorage.getItem('wa_template') || 'Hi {name}! Please RSVP at {link}';\n        const link = `${siteUrl}/rsvp/${guest.unique_code}`;\n        return template.replace(/{name}/g, guest.name).replace(/{link}/g, link);\n      }\n\n      // Generate WhatsApp link\n      function getWhatsAppLink(guest) {\n        if (!guest.phone) return null;\n        const message = encodeURIComponent(getWhatsAppMessage(guest));\n        // Clean phone number - remove spaces, dashes, etc\n        const phone = guest.phone.replace(/[^0-9+]/g, '').replace(/^\\+/, '');\n        return `https://wa.me/${phone}?text=${message}`;\n      }\n\n      // Open WhatsApp\n      window.openWhatsApp = function(guestId) {\n        const guest = guests.find(g => g.id === guestId);\n        if (!guest) return;\n        \n        const link = getWhatsAppLink(guest);\n        if (link) {\n          window.open(link, '_blank');\n        } else {\n          showToast('No phone number for this guest', 'error');\n        }\n      };\n\n      // Copy WhatsApp message\n      window.copyWhatsAppMessage = async function(guestId) {\n        const guest = guests.find(g => g.id === guestId);\n        if (!guest) return;\n        \n        const message = getWhatsAppMessage(guest);\n        try {\n          await navigator.clipboard.writeText(message);\n          showToast('Message copied!');\n        } catch (error) {\n          showToast('Failed to copy message', 'error');\n        }\n      };\n\n      // Get filtered guests for invitations\n      function getFilteredInvitationGuests() {\n        const sideFilter = document.getElementById('invite-filter-side')?.value || 'all';\n        const phoneFilter = document.getElementById('invite-filter-phone')?.value || 'yes';\n\n        return guests.filter(guest => {\n          const matchesSide = sideFilter === 'all' || guest.guest_side === sideFilter;\n          const matchesPhone = phoneFilter === 'all' || (phoneFilter === 'yes' && guest.phone);\n          return matchesSide && matchesPhone;\n        });\n      }\n\n      // Render Invitations Table\n      function renderInvitations() {\n        const tbody = document.querySelector('#invitations-table tbody');\n        if (!tbody) return;\n\n        const filteredGuests = getFilteredInvitationGuests();\n        \n        // Update count\n        const countEl = document.getElementById('invite-count');\n        if (countEl) {\n          countEl.textContent = `${filteredGuests.length} guests`;\n        }\n\n        if (filteredGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">No guests found</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = filteredGuests.map(guest => {\n          const hasPhone = !!guest.phone;\n          return `\n            <tr>\n              <td>${escapeHtml(guest.name)}</td>\n              <td>${getSideBadge(guest.guest_side)}</td>\n              <td>${escapeHtml(guest.phone || '-')}</td>\n              <td>\n                <span class=\"badge badge-${guest.rsvp_status === 'yes' ? 'success' : guest.rsvp_status === 'no' ? 'danger' : 'warning'}\">\n                  ${guest.rsvp_status === 'yes' ? 'Confirmed' : guest.rsvp_status === 'no' ? 'Declined' : 'Pending'}\n                </span>\n              </td>\n              <td>\n                ${hasPhone ? `\n                  <button class=\"btn btn-sm btn-primary\" onclick=\"openWhatsApp('${guest.id}')\" style=\"background: #25D366;\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"white\" style=\"width: 1rem; height: 1rem; margin-right: 0.25rem;\"><path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z\"/></svg>\n                    Send\n                  </button>\n                  <button class=\"btn btn-sm btn-secondary\" onclick=\"copyWhatsAppMessage('${guest.id}')\" style=\"margin-left: 0.25rem;\">\n                    Copy\n                  </button>\n                ` : `\n                  <span style=\"color: #718096; font-size: 0.75rem;\">No phone</span>\n                `}\n              </td>\n            </tr>\n          `;\n        }).join('');\n      }\n    })();</script> </body> </html>"], ['<html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="robots" content="noindex, nofollow"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet"><title>', "</title>", `</head> <body> <div class="admin-layout"> <!-- Sidebar --> <aside class="sidebar"> <div class="sidebar-title">Wedding Admin</div> <nav class="sidebar-nav"> <a href="#dashboard" class="sidebar-link active" data-tab="dashboard"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
Dashboard
</a> <a href="#guests" class="sidebar-link" data-tab="guests"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
Guests
</a> <a href="#invitations" class="sidebar-link" data-tab="invitations"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
Send Invites
</a> <a href="#messages" class="sidebar-link" data-tab="messages"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
Messages
</a> <a href="#import" class="sidebar-link" data-tab="import"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
Import CSV
</a> </nav> <div style="margin-top: auto; padding-top: 2rem;"> <a href="/" class="sidebar-link" target="_blank"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
View Website
</a> <button class="sidebar-link" id="logout-btn" style="width: 100%; border: none; background: none; cursor: pointer;"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
Logout
</button> </div> </aside> <!-- Main Content --> <main class="main-content"> <!-- Dashboard Tab --> <div id="dashboard-tab" class="tabs active"> <div class="page-header"> <h1 class="page-title">Dashboard</h1> </div> <div class="stats-grid" id="stats-container"> <div class="stat-card"> <div class="stat-label">Total Invited</div> <div class="stat-value" id="stat-total">-</div> </div> <div class="stat-card"> <div class="stat-label">Confirmed</div> <div class="stat-value" id="stat-confirmed">-</div> </div> <div class="stat-card"> <div class="stat-label">Pending</div> <div class="stat-value pending" id="stat-pending">-</div> </div> <div class="stat-card"> <div class="stat-label">Declined</div> <div class="stat-value declined" id="stat-declined">-</div> </div> <div class="stat-card"> <div class="stat-label">Total Attending</div> <div class="stat-value" id="stat-attending">-</div> </div> </div> <div class="card"> <div class="card-header"> <h2 class="card-title">Recent RSVPs</h2> </div> <div class="card-body"> <div class="table-container"> <table id="recent-rsvps"> <thead> <tr> <th>Name</th> <th>Status</th> <th>Plus Ones</th> <th>Updated</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Guests Tab --> <div id="guests-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Guest List</h1> <button class="btn btn-primary" id="add-guest-btn"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1rem; height: 1rem;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
Add Guest
</button> </div> <!-- Filters --> <div class="card" style="margin-bottom: 1rem;"> <div class="card-body" style="padding: 1rem;"> <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;"> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by Side</label> <select class="form-select" id="filter-side" style="min-width: 150px;"> <option value="all">All Guests</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> <option value="both">Both Sides</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by RSVP</label> <select class="form-select" id="filter-rsvp" style="min-width: 150px;"> <option value="all">All Status</option> <option value="pending">Pending</option> <option value="yes">Confirmed</option> <option value="no">Declined</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Search</label> <input type="text" class="form-input" id="filter-search" placeholder="Search by name..." style="min-width: 200px;"> </div> <div style="margin-left: auto; align-self: flex-end;"> <span id="filter-count" style="color: #718096; font-size: 0.875rem;"></span> </div> </div> </div> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="guests-table"> <thead> <tr> <th>Name</th> <th>Side</th> <th>Phone</th> <th>+1s</th> <th>Attending</th> <th>RSVP</th> <th>Unique Link</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Invitations Tab --> <div id="invitations-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Send WhatsApp Invitations</h1> </div> <!-- Message Template Card --> <div class="card" style="margin-bottom: 1.5rem;"> <div class="card-header"> <h2 class="card-title">Message Template</h2> </div> <div class="card-body"> <p style="margin-bottom: 1rem; color: #718096; font-size: 0.875rem;">
Configure the invitation message template. Use <code>`, "</code> for guest name and <code>", '</code> for their unique RSVP link.\n</p> <div class="form-group"> <label class="form-label">WhatsApp Message Template</label> <textarea class="form-textarea" id="wa-template" rows="5" style="font-family: monospace;">', `</textarea> </div> <button class="btn btn-primary" id="save-template-btn">Save Template</button> </div> </div> <!-- Filter and Guest List --> <div class="card" style="margin-bottom: 1rem;"> <div class="card-body" style="padding: 1rem;"> <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;"> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Filter by Side</label> <select class="form-select" id="invite-filter-side" style="min-width: 150px;"> <option value="all">All Guests</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> </select> </div> <div class="form-group" style="margin: 0;"> <label class="form-label" style="margin-bottom: 0.25rem;">Has Phone Number</label> <select class="form-select" id="invite-filter-phone" style="min-width: 150px;"> <option value="yes">With Phone Only</option> <option value="all">All Guests</option> </select> </div> <div style="margin-left: auto; align-self: flex-end;"> <span id="invite-count" style="color: #718096; font-size: 0.875rem;"></span> </div> </div> </div> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="invitations-table"> <thead> <tr> <th>Name</th> <th>Side</th> <th>Phone</th> <th>RSVP Status</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Messages Tab --> <div id="messages-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Messages</h1> <button class="btn btn-primary" id="add-message-btn"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1rem; height: 1rem;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
Add Message
</button> </div> <div class="card"> <div class="card-body"> <div class="table-container"> <table id="messages-table"> <thead> <tr> <th>Guest Name</th> <th>Message</th> <th>Visible</th> <th>Date</th> <th>Actions</th> </tr> </thead> <tbody></tbody> </table> </div> </div> </div> </div> <!-- Import Tab --> <div id="import-tab" class="tabs"> <div class="page-header"> <h1 class="page-title">Import Guests from CSV</h1> </div> <div class="card"> <div class="card-body"> <p style="margin-bottom: 1rem; color: #718096;">
Upload a CSV file with guest information. The file should have the following columns:
<code style="background: #f7fafc; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">name, email, phone, guest_side, invited_to, max_plus_ones</code> </p> <p style="margin-bottom: 1.5rem; color: #718096; font-size: 0.875rem;">
Note: <code>guest_side</code> can be "groom", "bride", or "both" (default). <code>invited_to</code> can be "ceremony", "reception", or "both" (default). <code>max_plus_ones</code> is the number of additional guests they can bring (default: 0).
</p> <label class="file-upload" id="csv-upload"> <input type="file" accept=".csv" id="csv-file"> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 3rem; height: 3rem; margin-bottom: 1rem; color: #718096;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> <p style="color: #4a5568; font-weight: 500;">Click to upload or drag and drop</p> <p style="color: #718096; font-size: 0.875rem;">CSV file only</p> </label> <div id="csv-preview" style="margin-top: 1.5rem; display: none;"> <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Preview</h3> <div class="table-container"> <table id="csv-preview-table"> <thead></thead> <tbody></tbody> </table> </div> <div style="margin-top: 1rem; display: flex; gap: 0.75rem;"> <button class="btn btn-primary" id="import-btn">Import Guests</button> <button class="btn btn-secondary" id="cancel-import-btn">Cancel</button> </div> </div> <div id="import-result" style="margin-top: 1.5rem; display: none;"></div> </div> </div> <div class="card"> <div class="card-header"> <h2 class="card-title">Sample CSV Format</h2> </div> <div class="card-body"> <pre style="background: #f7fafc; padding: 1rem; border-radius: 0.375rem; overflow-x: auto; font-size: 0.875rem;">name,email,phone,guest_side,invited_to,max_plus_ones
John Doe,john@example.com,+1234567890,groom,both,1
Jane Smith,jane@example.com,,bride,ceremony,0
Bob Johnson,,+0987654321,both,reception,2</pre> </div> </div> </div> </main> </div> <!-- Add Guest Modal --> <div class="modal-overlay" id="add-guest-modal"> <div class="modal"> <div class="modal-header"> <h3 class="modal-title">Add New Guest</h3> <button class="modal-close" data-close-modal>&times;</button> </div> <form id="add-guest-form"> <div class="modal-body"> <div class="form-group"> <label class="form-label">Name *</label> <input type="text" class="form-input" name="name" required> </div> <div class="form-group"> <label class="form-label">Email</label> <input type="email" class="form-input" name="email"> </div> <div class="form-group"> <label class="form-label">Phone (for WhatsApp)</label> <input type="tel" class="form-input" name="phone" placeholder="+628123456789"> </div> <div class="form-group"> <label class="form-label">Guest Side</label> <select class="form-select" name="guest_side"> <option value="both">Both (Mutual Friend)</option> <option value="groom">Groom's Side</option> <option value="bride">Bride's Side</option> </select> </div> <div class="form-group"> <label class="form-label">Invited To</label> <select class="form-select" name="invited_to"> <option value="both">Both Events</option> <option value="ceremony">Ceremony Only</option> <option value="reception">Reception Only</option> </select> </div> <div class="form-group"> <label class="form-label">Allocated Plus Ones</label> <input type="number" class="form-input" name="max_plus_ones" min="0" max="10" value="0"> <p style="font-size: 0.75rem; color: #718096; margin-top: 0.25rem;">Number of additional guests this person can bring</p> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary">Add Guest</button> </div> </form> </div> </div> <!-- Add Message Modal --> <div class="modal-overlay" id="add-message-modal"> <div class="modal"> <div class="modal-header"> <h3 class="modal-title">Add New Message</h3> <button class="modal-close" data-close-modal>&times;</button> </div> <form id="add-message-form"> <div class="modal-body"> <div class="form-group"> <label class="form-label">Guest Name *</label> <input type="text" class="form-input" name="guest_name" required> </div> <div class="form-group"> <label class="form-label">Message *</label> <textarea class="form-textarea" name="content" required></textarea> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-close-modal>Cancel</button> <button type="submit" class="btn btn-primary">Add Message</button> </div> </form> </div> </div> <!-- Toast --> <div class="toast" id="toast"></div> <script>(function(){`, "\n      // State\n      let guests = [];\n      let messages = [];\n      let csvData = [];\n\n      // DOM Elements\n      const tabs = document.querySelectorAll('.tabs');\n      const sidebarLinks = document.querySelectorAll('.sidebar-link[data-tab]');\n      const toast = document.getElementById('toast');\n\n      // Initialize\n      document.addEventListener('DOMContentLoaded', () => {\n        loadStats();\n        loadGuests();\n        loadMessages();\n        setupEventListeners();\n        loadWhatsAppTemplate();\n      });\n\n      // Tab Navigation\n      function switchTab(tabName) {\n        tabs.forEach(tab => tab.classList.remove('active'));\n        sidebarLinks.forEach(link => link.classList.remove('active'));\n\n        document.getElementById(\\`\\${tabName}-tab\\`)?.classList.add('active');\n        document.querySelector(\\`[data-tab=\"\\${tabName}\"]\\`)?.classList.add('active');\n      }\n\n      sidebarLinks.forEach(link => {\n        link.addEventListener('click', (e) => {\n          e.preventDefault();\n          const tab = link.dataset.tab;\n          switchTab(tab);\n          history.pushState(null, '', \\`#\\${tab}\\`);\n        });\n      });\n\n      // Handle initial hash\n      const initialTab = window.location.hash.slice(1) || 'dashboard';\n      switchTab(initialTab);\n\n      // Toast Notification\n      function showToast(message, type = 'success') {\n        toast.textContent = message;\n        toast.className = \\`toast \\${type} show\\`;\n        setTimeout(() => {\n          toast.classList.remove('show');\n        }, 3000);\n      }\n\n      // Load Stats\n      async function loadStats() {\n        try {\n          const response = await fetch('/api/admin/guests?action=stats');\n          if (!response.ok) throw new Error('Failed to load stats');\n          const stats = await response.json();\n\n          document.getElementById('stat-total').textContent = stats.total;\n          document.getElementById('stat-confirmed').textContent = stats.confirmed;\n          document.getElementById('stat-pending').textContent = stats.pending;\n          document.getElementById('stat-declined').textContent = stats.declined;\n          document.getElementById('stat-attending').textContent = stats.totalGuests;\n        } catch (error) {\n          console.error('Error loading stats:', error);\n        }\n      }\n\n      // Load Guests\n      async function loadGuests() {\n        try {\n          const response = await fetch('/api/admin/guests');\n          if (!response.ok) throw new Error('Failed to load guests');\n          const data = await response.json();\n          guests = data.guests || [];\n          renderGuests();\n          renderRecentRSVPs();\n          renderInvitations();\n        } catch (error) {\n          console.error('Error loading guests:', error);\n        }\n      }\n\n      // Get filtered guests\n      function getFilteredGuests() {\n        const sideFilter = document.getElementById('filter-side')?.value || 'all';\n        const rsvpFilter = document.getElementById('filter-rsvp')?.value || 'all';\n        const searchFilter = document.getElementById('filter-search')?.value?.toLowerCase() || '';\n\n        return guests.filter(guest => {\n          const matchesSide = sideFilter === 'all' || guest.guest_side === sideFilter;\n          const matchesRsvp = rsvpFilter === 'all' || guest.rsvp_status === rsvpFilter;\n          const matchesSearch = !searchFilter || guest.name.toLowerCase().includes(searchFilter);\n          return matchesSide && matchesRsvp && matchesSearch;\n        });\n      }\n\n      // Get side badge HTML\n      function getSideBadge(side) {\n        const colors = {\n          groom: 'background: #BEE3F8; color: #2B6CB0;',\n          bride: 'background: #FED7E2; color: #97266D;',\n          both: 'background: #E9D8FD; color: #6B46C1;'\n        };\n        const labels = {\n          groom: \"Groom's\",\n          bride: \"Bride's\",\n          both: 'Both'\n        };\n        return \\`<span class=\"badge\" style=\"\\${colors[side] || colors.both}\">\\${labels[side] || 'Both'}</span>\\`;\n      }\n\n      // Render Guests Table\n      function renderGuests() {\n        const tbody = document.querySelector('#guests-table tbody');\n        const filteredGuests = getFilteredGuests();\n        \n        // Update count\n        const countEl = document.getElementById('filter-count');\n        if (countEl) {\n          countEl.textContent = \\`Showing \\${filteredGuests.length} of \\${guests.length} guests\\`;\n        }\n\n        if (filteredGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"8\" style=\"text-align: center; color: #718096;\">No guests found</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = filteredGuests.map(guest => \\`\n          <tr>\n            <td>\\${escapeHtml(guest.name)}</td>\n            <td>\\${getSideBadge(guest.guest_side)}</td>\n            <td>\\${escapeHtml(guest.phone || '-')}</td>\n            <td>\\${guest.max_plus_ones || 0}</td>\n            <td>\\${guest.attending_count || 0}</td>\n            <td>\n              <span class=\"badge badge-\\${guest.rsvp_status === 'yes' ? 'success' : guest.rsvp_status === 'no' ? 'danger' : 'warning'}\">\n                \\${guest.rsvp_status === 'yes' ? 'Confirmed' : guest.rsvp_status === 'no' ? 'Declined' : 'Pending'}\n              </span>\n            </td>\n            <td>\n              <div class=\"copy-link\">\n                <input type=\"text\" value=\"\\${siteUrl}/rsvp/\\${guest.unique_code}\" readonly />\n                <button class=\"btn btn-sm btn-secondary\" onclick=\"copyLink('\\${guest.unique_code}')\">Copy</button>\n              </div>\n            </td>\n            <td>\n              <span class=\"action-link danger\" onclick=\"deleteGuest('\\${guest.id}')\">Delete</span>\n            </td>\n          </tr>\n        \\`).join('');\n      }\n\n      // Render Recent RSVPs\n      function renderRecentRSVPs() {\n        const tbody = document.querySelector('#recent-rsvps tbody');\n        const recentGuests = guests\n          .filter(g => g.rsvp_status !== 'pending')\n          .sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())\n          .slice(0, 10);\n\n        if (recentGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"4\" style=\"text-align: center; color: #718096;\">No RSVPs yet</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = recentGuests.map(guest => \\`\n          <tr>\n            <td>\\${escapeHtml(guest.name)}</td>\n            <td>\n              <span class=\"badge badge-\\${guest.rsvp_status === 'yes' ? 'success' : 'danger'}\">\n                \\${guest.rsvp_status === 'yes' ? 'Confirmed' : 'Declined'}\n              </span>\n            </td>\n            <td>\\${guest.attending_count || 0}</td>\n            <td>\\${new Date(guest.updated_at).toLocaleDateString()}</td>\n          </tr>\n        \\`).join('');\n      }\n\n      // Load Messages\n      async function loadMessages() {\n        try {\n          const response = await fetch('/api/admin/messages');\n          if (!response.ok) throw new Error('Failed to load messages');\n          const data = await response.json();\n          messages = data.messages || [];\n          renderMessages();\n        } catch (error) {\n          console.error('Error loading messages:', error);\n        }\n      }\n\n      // Render Messages Table\n      function renderMessages() {\n        const tbody = document.querySelector('#messages-table tbody');\n        if (messages.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">No messages yet</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = messages.map(msg => \\`\n          <tr>\n            <td>\\${escapeHtml(msg.guest_name)}</td>\n            <td style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">\n              \\${escapeHtml(msg.content)}\n            </td>\n            <td>\n              <label style=\"cursor: pointer;\">\n                <input type=\"checkbox\" \\${msg.is_visible ? 'checked' : ''} onchange=\"toggleVisibility('\\${msg.id}', this.checked)\" />\n              </label>\n            </td>\n            <td>\\${new Date(msg.created_at).toLocaleDateString()}</td>\n            <td>\n              <span class=\"action-link danger\" onclick=\"deleteMessage('\\${msg.id}')\">Delete</span>\n            </td>\n          </tr>\n        \\`).join('');\n      }\n\n      // Event Listeners\n      function setupEventListeners() {\n        // Logout\n        document.getElementById('logout-btn').addEventListener('click', async () => {\n          await fetch('/api/admin/logout', { method: 'POST' });\n          window.location.href = '/admin/login';\n        });\n\n        // Add Guest Modal\n        document.getElementById('add-guest-btn').addEventListener('click', () => {\n          document.getElementById('add-guest-modal').classList.add('is-open');\n        });\n\n        // Add Message Modal\n        document.getElementById('add-message-btn').addEventListener('click', () => {\n          document.getElementById('add-message-modal').classList.add('is-open');\n        });\n\n        // Close Modal\n        document.querySelectorAll('[data-close-modal]').forEach(btn => {\n          btn.addEventListener('click', () => {\n            document.querySelectorAll('.modal-overlay').forEach(modal => {\n              modal.classList.remove('is-open');\n            });\n          });\n        });\n\n        // Close modal on overlay click\n        document.querySelectorAll('.modal-overlay').forEach(overlay => {\n          overlay.addEventListener('click', (e) => {\n            if (e.target === overlay) {\n              overlay.classList.remove('is-open');\n            }\n          });\n        });\n\n        // Add Guest Form\n        document.getElementById('add-guest-form').addEventListener('submit', async (e) => {\n          e.preventDefault();\n          const form = e.target;\n          const formData = new FormData(form);\n\n          try {\n            const response = await fetch('/api/admin/guests', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                action: 'add',\n                guest: {\n                  name: formData.get('name'),\n                  email: formData.get('email'),\n                  phone: formData.get('phone'),\n                  guest_side: formData.get('guest_side') || 'both',\n                  invited_to: formData.get('invited_to'),\n                  max_plus_ones: parseInt(formData.get('max_plus_ones')) || 0,\n                }\n              })\n            });\n\n            if (!response.ok) throw new Error('Failed to add guest');\n\n            showToast('Guest added successfully');\n            form.reset();\n            document.getElementById('add-guest-modal').classList.remove('is-open');\n            loadGuests();\n            loadStats();\n          } catch (error) {\n            showToast('Failed to add guest', 'error');\n          }\n        });\n\n        // Add Message Form\n        document.getElementById('add-message-form').addEventListener('submit', async (e) => {\n          e.preventDefault();\n          const form = e.target;\n          const formData = new FormData(form);\n\n          try {\n            const response = await fetch('/api/admin/messages', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                guest_name: formData.get('guest_name'),\n                content: formData.get('content'),\n              })\n            });\n\n            if (!response.ok) throw new Error('Failed to add message');\n\n            showToast('Message added successfully');\n            form.reset();\n            document.getElementById('add-message-modal').classList.remove('is-open');\n            loadMessages();\n          } catch (error) {\n            showToast('Failed to add message', 'error');\n          }\n        });\n\n        // CSV Upload\n        const csvFile = document.getElementById('csv-file');\n        csvFile.addEventListener('change', handleCSVUpload);\n        document.getElementById('import-btn').addEventListener('click', importCSV);\n        document.getElementById('cancel-import-btn').addEventListener('click', () => {\n          csvData = [];\n          document.getElementById('csv-preview').style.display = 'none';\n          document.getElementById('csv-file').value = '';\n        });\n\n        // Filter event listeners\n        document.getElementById('filter-side')?.addEventListener('change', renderGuests);\n        document.getElementById('filter-rsvp')?.addEventListener('change', renderGuests);\n        document.getElementById('filter-search')?.addEventListener('input', renderGuests);\n\n        // Invitation filter event listeners\n        document.getElementById('invite-filter-side')?.addEventListener('change', renderInvitations);\n        document.getElementById('invite-filter-phone')?.addEventListener('change', renderInvitations);\n\n        // Save WhatsApp template\n        document.getElementById('save-template-btn')?.addEventListener('click', () => {\n          const template = document.getElementById('wa-template')?.value || '';\n          localStorage.setItem('wa_template', template);\n          showToast('Template saved!');\n        });\n      }\n\n      // Copy Link\n      window.copyLink = async function(code) {\n        const link = \\`\\${siteUrl}/rsvp/\\${code}\\`;\n        try {\n          await navigator.clipboard.writeText(link);\n          showToast('Link copied to clipboard');\n        } catch (error) {\n          showToast('Failed to copy link', 'error');\n        }\n      };\n\n      // Delete Guest\n      window.deleteGuest = async function(id) {\n        if (!confirm('Are you sure you want to delete this guest?')) return;\n\n        try {\n          const response = await fetch('/api/admin/guests', {\n            method: 'DELETE',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id })\n          });\n\n          if (!response.ok) throw new Error('Failed to delete guest');\n\n          showToast('Guest deleted');\n          loadGuests();\n          loadStats();\n        } catch (error) {\n          showToast('Failed to delete guest', 'error');\n        }\n      };\n\n      // Toggle Message Visibility\n      window.toggleVisibility = async function(id, isVisible) {\n        try {\n          const response = await fetch('/api/admin/messages', {\n            method: 'PATCH',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id, is_visible: isVisible })\n          });\n\n          if (!response.ok) throw new Error('Failed to update message');\n          showToast('Message visibility updated');\n        } catch (error) {\n          showToast('Failed to update message', 'error');\n          loadMessages();\n        }\n      };\n\n      // Delete Message\n      window.deleteMessage = async function(id) {\n        if (!confirm('Are you sure you want to delete this message?')) return;\n\n        try {\n          const response = await fetch('/api/admin/messages', {\n            method: 'DELETE',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id })\n          });\n\n          if (!response.ok) throw new Error('Failed to delete message');\n\n          showToast('Message deleted');\n          loadMessages();\n        } catch (error) {\n          showToast('Failed to delete message', 'error');\n        }\n      };\n\n      // CSV Upload Handler\n      function handleCSVUpload(e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = function(event) {\n          const text = event.target.result;\n          csvData = parseCSV(text);\n\n          if (csvData.length === 0) {\n            showToast('No valid data found in CSV', 'error');\n            return;\n          }\n\n          renderCSVPreview();\n          document.getElementById('csv-preview').style.display = 'block';\n        };\n        reader.readAsText(file);\n      }\n\n      // Parse CSV\n      function parseCSV(text) {\n        const lines = text.split('\\\\n').filter(line => line.trim());\n        if (lines.length < 2) return [];\n\n        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());\n        const nameIndex = headers.indexOf('name');\n        const emailIndex = headers.indexOf('email');\n        const phoneIndex = headers.indexOf('phone');\n        const guestSideIndex = headers.indexOf('guest_side');\n        const invitedToIndex = headers.indexOf('invited_to');\n        const maxPlusOnesIndex = headers.indexOf('max_plus_ones');\n\n        if (nameIndex === -1) {\n          showToast('CSV must have a \"name\" column', 'error');\n          return [];\n        }\n\n        return lines.slice(1).map(line => {\n          const values = line.split(',').map(v => v.trim());\n          return {\n            name: values[nameIndex] || '',\n            email: emailIndex !== -1 ? values[emailIndex] : '',\n            phone: phoneIndex !== -1 ? values[phoneIndex] : '',\n            guest_side: guestSideIndex !== -1 ? values[guestSideIndex] : 'both',\n            invited_to: invitedToIndex !== -1 ? values[invitedToIndex] : 'both',\n            max_plus_ones: maxPlusOnesIndex !== -1 ? parseInt(values[maxPlusOnesIndex]) || 0 : 0,\n          };\n        }).filter(guest => guest.name);\n      }\n\n      // Render CSV Preview\n      function renderCSVPreview() {\n        const thead = document.querySelector('#csv-preview-table thead');\n        const tbody = document.querySelector('#csv-preview-table tbody');\n\n        thead.innerHTML = '<tr><th>Name</th><th>Phone</th><th>Side</th><th>Invited To</th><th>+1s</th></tr>';\n        tbody.innerHTML = csvData.slice(0, 10).map(guest => \\`\n          <tr>\n            <td>\\${escapeHtml(guest.name)}</td>\n            <td>\\${escapeHtml(guest.phone || '-')}</td>\n            <td>\\${escapeHtml(guest.guest_side || 'both')}</td>\n            <td>\\${escapeHtml(guest.invited_to)}</td>\n            <td>\\${guest.max_plus_ones || 0}</td>\n          </tr>\n        \\`).join('');\n\n        if (csvData.length > 10) {\n          tbody.innerHTML += \\`<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">... and \\${csvData.length - 10} more</td></tr>\\`;\n        }\n      }\n\n      // Import CSV\n      async function importCSV() {\n        if (csvData.length === 0) return;\n\n        const importBtn = document.getElementById('import-btn');\n        importBtn.disabled = true;\n        importBtn.textContent = 'Importing...';\n\n        try {\n          const response = await fetch('/api/admin/guests', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              action: 'import',\n              guests: csvData\n            })\n          });\n\n          if (!response.ok) throw new Error('Failed to import guests');\n\n          const result = await response.json();\n\n          document.getElementById('import-result').style.display = 'block';\n          document.getElementById('import-result').innerHTML = \\`\n            <div style=\"padding: 1rem; background: #C6F6D5; border-radius: 0.375rem;\">\n              <p><strong>Import Complete!</strong></p>\n              <p>Successfully imported: \\${result.success}</p>\n              \\${result.failed > 0 ? \\`<p style=\"color: #E53E3E;\">Failed: \\${result.failed}</p>\\` : ''}\n            </div>\n          \\`;\n\n          csvData = [];\n          document.getElementById('csv-preview').style.display = 'none';\n          document.getElementById('csv-file').value = '';\n          loadGuests();\n          loadStats();\n        } catch (error) {\n          showToast('Failed to import guests', 'error');\n        } finally {\n          importBtn.disabled = false;\n          importBtn.textContent = 'Import Guests';\n        }\n      }\n\n      // Escape HTML\n      function escapeHtml(text) {\n        if (!text) return '';\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n      }\n\n      // Load WhatsApp Template from localStorage\n      function loadWhatsAppTemplate() {\n        const saved = localStorage.getItem('wa_template');\n        const templateEl = document.getElementById('wa-template');\n        if (saved && templateEl) {\n          templateEl.value = saved;\n        }\n      }\n\n      // Get WhatsApp message for a guest\n      function getWhatsAppMessage(guest) {\n        const templateEl = document.getElementById('wa-template');\n        const template = templateEl?.value || localStorage.getItem('wa_template') || 'Hi {name}! Please RSVP at {link}';\n        const link = \\`\\${siteUrl}/rsvp/\\${guest.unique_code}\\`;\n        return template.replace(/{name}/g, guest.name).replace(/{link}/g, link);\n      }\n\n      // Generate WhatsApp link\n      function getWhatsAppLink(guest) {\n        if (!guest.phone) return null;\n        const message = encodeURIComponent(getWhatsAppMessage(guest));\n        // Clean phone number - remove spaces, dashes, etc\n        const phone = guest.phone.replace(/[^0-9+]/g, '').replace(/^\\\\+/, '');\n        return \\`https://wa.me/\\${phone}?text=\\${message}\\`;\n      }\n\n      // Open WhatsApp\n      window.openWhatsApp = function(guestId) {\n        const guest = guests.find(g => g.id === guestId);\n        if (!guest) return;\n        \n        const link = getWhatsAppLink(guest);\n        if (link) {\n          window.open(link, '_blank');\n        } else {\n          showToast('No phone number for this guest', 'error');\n        }\n      };\n\n      // Copy WhatsApp message\n      window.copyWhatsAppMessage = async function(guestId) {\n        const guest = guests.find(g => g.id === guestId);\n        if (!guest) return;\n        \n        const message = getWhatsAppMessage(guest);\n        try {\n          await navigator.clipboard.writeText(message);\n          showToast('Message copied!');\n        } catch (error) {\n          showToast('Failed to copy message', 'error');\n        }\n      };\n\n      // Get filtered guests for invitations\n      function getFilteredInvitationGuests() {\n        const sideFilter = document.getElementById('invite-filter-side')?.value || 'all';\n        const phoneFilter = document.getElementById('invite-filter-phone')?.value || 'yes';\n\n        return guests.filter(guest => {\n          const matchesSide = sideFilter === 'all' || guest.guest_side === sideFilter;\n          const matchesPhone = phoneFilter === 'all' || (phoneFilter === 'yes' && guest.phone);\n          return matchesSide && matchesPhone;\n        });\n      }\n\n      // Render Invitations Table\n      function renderInvitations() {\n        const tbody = document.querySelector('#invitations-table tbody');\n        if (!tbody) return;\n\n        const filteredGuests = getFilteredInvitationGuests();\n        \n        // Update count\n        const countEl = document.getElementById('invite-count');\n        if (countEl) {\n          countEl.textContent = \\`\\${filteredGuests.length} guests\\`;\n        }\n\n        if (filteredGuests.length === 0) {\n          tbody.innerHTML = '<tr><td colspan=\"5\" style=\"text-align: center; color: #718096;\">No guests found</td></tr>';\n          return;\n        }\n\n        tbody.innerHTML = filteredGuests.map(guest => {\n          const hasPhone = !!guest.phone;\n          return \\`\n            <tr>\n              <td>\\${escapeHtml(guest.name)}</td>\n              <td>\\${getSideBadge(guest.guest_side)}</td>\n              <td>\\${escapeHtml(guest.phone || '-')}</td>\n              <td>\n                <span class=\"badge badge-\\${guest.rsvp_status === 'yes' ? 'success' : guest.rsvp_status === 'no' ? 'danger' : 'warning'}\">\n                  \\${guest.rsvp_status === 'yes' ? 'Confirmed' : guest.rsvp_status === 'no' ? 'Declined' : 'Pending'}\n                </span>\n              </td>\n              <td>\n                \\${hasPhone ? \\`\n                  <button class=\"btn btn-sm btn-primary\" onclick=\"openWhatsApp('\\${guest.id}')\" style=\"background: #25D366;\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"white\" style=\"width: 1rem; height: 1rem; margin-right: 0.25rem;\"><path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z\"/></svg>\n                    Send\n                  </button>\n                  <button class=\"btn btn-sm btn-secondary\" onclick=\"copyWhatsAppMessage('\\${guest.id}')\" style=\"margin-left: 0.25rem;\">\n                    Copy\n                  </button>\n                \\` : \\`\n                  <span style=\"color: #718096; font-size: 0.75rem;\">No phone</span>\n                \\`}\n              </td>\n            </tr>\n          \\`;\n        }).join('');\n      }\n    })();</script> </body> </html>"])), pageTitle, renderHead(), "{name}", "{link}", `Hi {name}! 

You are cordially invited to our wedding celebration! Please RSVP using your personal link below:

{link}

We hope to see you there! `, defineScriptVars({ siteUrl }));
}, "/Users/aldisf/workspace/wedding_website_v2/src/pages/admin/index.astro", void 0);
const $$file = "/Users/aldisf/workspace/wedding_website_v2/src/pages/admin/index.astro";
const $$url = "/admin";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Index,
  file: $$file,
  prerender,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
